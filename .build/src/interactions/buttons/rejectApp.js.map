{"version":3,"file":"rejectApp.js","sources":["src/interactions/buttons/rejectApp.ts"],"sourceRoot":"/","sourcesContent":["import { t } from \"../../lang\";\r\nimport { ButtonHandler } from \"../../types/Interactions\";\r\nimport {\r\n  getCompletedApplication,\r\n  getServerApplication,\r\n  getServerGroupsByIds,\r\n} from \"../../utils/bot/getServer\";\r\nimport { onError } from \"../../utils/onError\";\r\nimport { getUserPermissions } from \"../../utils/calculateUserPermissions\";\r\nimport { GuildMember, PermissionFlagsBits } from \"discord.js\";\r\nimport { generateReasonModal } from \"../../utils/bot/generateReasonModal\";\r\n\r\nconst button: ButtonHandler = {\r\n  customId: \"rejApp\",\r\n  async execute(client, data, interaction) {\r\n    if (!interaction.guildId) return;\r\n    const [, applicationId, owner] = interaction.customId.split(\":\");\r\n    const application = await getCompletedApplication(applicationId, owner);\r\n    if (!application)\r\n      return interaction.reply(\r\n        (await onError(new Error(\"Application attempt not found\"))).discordMsg\r\n      );\r\n\r\n    if (application.status !== \"Pending\")\r\n      return interaction.reply(\r\n        (\r\n          await onError(new Error(\"Application already responded\"), {\r\n            id: applicationId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n    const applicationTrigger = await getServerApplication(\r\n      application.application,\r\n      interaction.guildId\r\n    );\r\n    if (!applicationTrigger)\r\n      return interaction.reply(\r\n        (await onError(new Error(\"Application not found\"))).discordMsg\r\n      );\r\n    const userPermissions = getUserPermissions(\r\n      interaction.member as GuildMember,\r\n      await getServerGroupsByIds(applicationTrigger.groups, interaction.guildId)\r\n    );\r\n    if (\r\n      !userPermissions.applications.respond &&\r\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\r\n    )\r\n      return interaction.reply(\r\n        (await onError(new Error(\"Missing respond permission\"))).discordMsg\r\n      );\r\n\r\n    return interaction.showModal(\r\n      generateReasonModal(interaction.customId, false)\r\n    );\r\n  },\r\n};\r\n\r\nexport default button;\r\n"],"names":[],"mappings":";;;;AAEA,yDAImC;AACnC,iDAA8C;AAC9C,mFAA0E;AAC1E,2CAA8D;AAC9D,6EAA0E;AAE1E,MAAM,MAAM,GAAkB;IAC5B,QAAQ,EAAE,QAAQ;IAClB,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW;QACrC,IAAI,CAAC,WAAW,CAAC,OAAO;YAAE,OAAO;QACjC,MAAM,CAAC,EAAE,aAAa,EAAE,KAAK,CAAC,GAAG,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACjE,MAAM,WAAW,GAAG,MAAM,IAAA,mCAAuB,EAAC,aAAa,EAAE,KAAK,CAAC,CAAC;QACxE,IAAI,CAAC,WAAW;YACd,OAAO,WAAW,CAAC,KAAK,CACtB,CAAC,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC,CAAC,CAAC,UAAU,CACvE,CAAC;QAEJ,IAAI,WAAW,CAAC,MAAM,KAAK,SAAS;YAClC,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,+BAA+B,CAAC,EAAE;gBACxD,EAAE,EAAE,aAAa;aAClB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QACJ,MAAM,kBAAkB,GAAG,MAAM,IAAA,gCAAoB,EACnD,WAAW,CAAC,WAAW,EACvB,WAAW,CAAC,OAAO,CACpB,CAAC;QACF,IAAI,CAAC,kBAAkB;YACrB,OAAO,WAAW,CAAC,KAAK,CACtB,CAAC,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,uBAAuB,CAAC,CAAC,CAAC,CAAC,UAAU,CAC/D,CAAC;QACJ,MAAM,eAAe,GAAG,IAAA,6CAAkB,EACxC,WAAW,CAAC,MAAqB,EACjC,MAAM,IAAA,gCAAoB,EAAC,kBAAkB,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,CAC3E,CAAC;QACF,IACE,CAAC,eAAe,CAAC,YAAY,CAAC,OAAO;YACrC,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,gCAAmB,CAAC,WAAW,CAAC;YAEpE,OAAO,WAAW,CAAC,KAAK,CACtB,CAAC,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC,CAAC,CAAC,UAAU,CACpE,CAAC;QAEJ,OAAO,WAAW,CAAC,SAAS,CAC1B,IAAA,yCAAmB,EAAC,WAAW,CAAC,QAAQ,EAAE,KAAK,CAAC,CACjD,CAAC;IACJ,CAAC;CACF,CAAC;AAEF,kBAAe,MAAM,CAAC","debug_id":"09db0cb9-4554-5f36-ae85-09384e60fc6d"}