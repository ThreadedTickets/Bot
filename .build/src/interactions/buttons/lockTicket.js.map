{"version":3,"file":"lockTicket.js","sources":["src/interactions/buttons/lockTicket.ts"],"sourceRoot":"/","sourcesContent":["import { GuildMember, MessageFlags, PermissionFlagsBits } from \"discord.js\";\r\nimport { t } from \"../../lang\";\r\nimport { ButtonHandler } from \"../../types/Interactions\";\r\nimport { getUserPermissions } from \"../../utils/calculateUserPermissions\";\r\nimport { getServerGroupsByIds, getTicket } from \"../../utils/bot/getServer\";\r\nimport { onError } from \"../../utils/onError\";\r\nimport { lockTicket } from \"../../utils/tickets/lock\";\r\n\r\nconst button: ButtonHandler = {\r\n  customId: \"lock\",\r\n  async execute(client, data, interaction) {\r\n    if (!interaction.guildId) return;\r\n    await interaction.reply({\r\n      content: t(data.lang!, \"THINK\"),\r\n      flags: [MessageFlags.Ephemeral],\r\n    });\r\n\r\n    const ticketId = interaction.customId.split(\":\")[1];\r\n    const ticket = await getTicket(ticketId, interaction.guildId);\r\n    if (!ticket)\r\n      return interaction.editReply(\r\n        (\r\n          await onError(new Error(\"Ticket not found\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n    const userPermissions = getUserPermissions(\r\n      interaction.member as GuildMember,\r\n      await getServerGroupsByIds(ticket.groups, interaction.guildId)\r\n    );\r\n\r\n    if (\r\n      !userPermissions.tickets.canLock &&\r\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\r\n    )\r\n      return interaction.editReply(\r\n        (\r\n          await onError(new Error(\"Missing lock permission\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n\r\n    await lockTicket(ticketId, data.lang!, interaction);\r\n  },\r\n};\r\n\r\nexport default button;\r\n"],"names":[],"mappings":";;;;AAAA,2CAA4E;AAC5E,qCAA+B;AAE/B,mFAA0E;AAC1E,yDAA4E;AAC5E,iDAA8C;AAC9C,mDAAsD;AAEtD,MAAM,MAAM,GAAkB;IAC5B,QAAQ,EAAE,MAAM;IAChB,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW;QACrC,IAAI,CAAC,WAAW,CAAC,OAAO;YAAE,OAAO;QACjC,MAAM,WAAW,CAAC,KAAK,CAAC;YACtB,OAAO,EAAE,IAAA,QAAC,EAAC,IAAI,CAAC,IAAK,EAAE,OAAO,CAAC;YAC/B,KAAK,EAAE,CAAC,yBAAY,CAAC,SAAS,CAAC;SAChC,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACpD,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAS,EAAC,QAAQ,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAI,CAAC,MAAM;YACT,OAAO,WAAW,CAAC,SAAS,CAC1B,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,kBAAkB,CAAC,EAAE;gBAC3C,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QACJ,MAAM,eAAe,GAAG,IAAA,6CAAkB,EACxC,WAAW,CAAC,MAAqB,EACjC,MAAM,IAAA,gCAAoB,EAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,CAC/D,CAAC;QAEF,IACE,CAAC,eAAe,CAAC,OAAO,CAAC,OAAO;YAChC,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,gCAAmB,CAAC,WAAW,CAAC;YAEpE,OAAO,WAAW,CAAC,SAAS,CAC1B,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,yBAAyB,CAAC,EAAE;gBAClD,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QAEJ,MAAM,IAAA,iBAAU,EAAC,QAAQ,EAAE,IAAI,CAAC,IAAK,EAAE,WAAW,CAAC,CAAC;IACtD,CAAC;CACF,CAAC;AAEF,kBAAe,MAAM,CAAC","debug_id":"a4047dac-1923-59b0-a159-cbecb6dcaa0d"}