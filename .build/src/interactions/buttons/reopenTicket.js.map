{"version":3,"file":"reopenTicket.js","sources":["src/interactions/buttons/reopenTicket.ts"],"sourceRoot":"/","sourcesContent":["import { GuildMember, MessageFlags, PermissionFlagsBits } from \"discord.js\";\r\nimport { t } from \"../../lang\";\r\nimport { ButtonHandler } from \"../../types/Interactions\";\r\nimport { getUserPermissions } from \"../../utils/calculateUserPermissions\";\r\nimport { getServerGroupsByIds, getTicket } from \"../../utils/bot/getServer\";\r\nimport { onError } from \"../../utils/onError\";\r\nimport { reopenTicket } from \"../../utils/tickets/reopen\";\r\n\r\nconst button: ButtonHandler = {\r\n  customId: \"reopen\",\r\n  async execute(client, data, interaction) {\r\n    if (!interaction.guildId) return;\r\n    await interaction.reply({\r\n      content: t(data.lang!, \"THINK\"),\r\n      flags: [MessageFlags.Ephemeral],\r\n    });\r\n\r\n    const ticketId = interaction.customId.split(\":\")[1];\r\n    const ticket = await getTicket(ticketId, interaction.guildId);\r\n    if (!ticket)\r\n      return interaction.editReply(\r\n        (\r\n          await onError(new Error(\"Ticket not found\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n    const userPermissions = getUserPermissions(\r\n      interaction.member as GuildMember,\r\n      await getServerGroupsByIds(ticket.groups, interaction.guildId)\r\n    );\r\n\r\n    if (\r\n      !userPermissions.tickets.canClose &&\r\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\r\n    )\r\n      return interaction.editReply(\r\n        (\r\n          await onError(new Error(\"Missing reopen permission\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n\r\n    await reopenTicket(ticketId, data.lang!, interaction);\r\n  },\r\n};\r\n\r\nexport default button;\r\n"],"names":[],"mappings":";;;;AAAA,2CAA4E;AAC5E,qCAA+B;AAE/B,mFAA0E;AAC1E,yDAA4E;AAC5E,iDAA8C;AAC9C,uDAA0D;AAE1D,MAAM,MAAM,GAAkB;IAC5B,QAAQ,EAAE,QAAQ;IAClB,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW;QACrC,IAAI,CAAC,WAAW,CAAC,OAAO;YAAE,OAAO;QACjC,MAAM,WAAW,CAAC,KAAK,CAAC;YACtB,OAAO,EAAE,IAAA,QAAC,EAAC,IAAI,CAAC,IAAK,EAAE,OAAO,CAAC;YAC/B,KAAK,EAAE,CAAC,yBAAY,CAAC,SAAS,CAAC;SAChC,CAAC,CAAC;QAEH,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACpD,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAS,EAAC,QAAQ,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAI,CAAC,MAAM;YACT,OAAO,WAAW,CAAC,SAAS,CAC1B,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,kBAAkB,CAAC,EAAE;gBAC3C,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QACJ,MAAM,eAAe,GAAG,IAAA,6CAAkB,EACxC,WAAW,CAAC,MAAqB,EACjC,MAAM,IAAA,gCAAoB,EAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,CAC/D,CAAC;QAEF,IACE,CAAC,eAAe,CAAC,OAAO,CAAC,QAAQ;YACjC,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,gCAAmB,CAAC,WAAW,CAAC;YAEpE,OAAO,WAAW,CAAC,SAAS,CAC1B,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,2BAA2B,CAAC,EAAE;gBACpD,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QAEJ,MAAM,IAAA,qBAAY,EAAC,QAAQ,EAAE,IAAI,CAAC,IAAK,EAAE,WAAW,CAAC,CAAC;IACxD,CAAC;CACF,CAAC;AAEF,kBAAe,MAAM,CAAC","debug_id":"c2eb5b1e-4b32-59cc-963d-2fbe3861ac22"}