{"version":3,"file":"closeTicket.js","sources":["src/interactions/buttons/closeTicket.ts"],"sourceRoot":"/","sourcesContent":["import {\r\n  ActionRowBuilder,\r\n  GuildMember,\r\n  ModalBuilder,\r\n  PermissionFlagsBits,\r\n  TextInputBuilder,\r\n  TextInputStyle,\r\n} from \"discord.js\";\r\nimport { ButtonHandler } from \"../../types/Interactions\";\r\nimport { getUserPermissions } from \"../../utils/calculateUserPermissions\";\r\nimport { getServerGroupsByIds, getTicket } from \"../../utils/bot/getServer\";\r\nimport { onError } from \"../../utils/onError\";\r\n\r\nconst button: ButtonHandler = {\r\n  customId: \"close\",\r\n  async execute(client, data, interaction) {\r\n    if (!interaction.guildId) return;\r\n    const ticketId = interaction.customId.split(\":\")[1];\r\n    const ticket = await getTicket(ticketId, interaction.guildId);\r\n    if (!ticket)\r\n      return interaction.reply(\r\n        (\r\n          await onError(new Error(\"Ticket not found\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n    const userPermissions = getUserPermissions(\r\n      interaction.member as GuildMember,\r\n      await getServerGroupsByIds(ticket.groups, interaction.guildId)\r\n    );\r\n\r\n    if (\r\n      !userPermissions.tickets.canCloseIfOwn &&\r\n      interaction.user.id === ticket.owner &&\r\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\r\n    )\r\n      return interaction.reply(\r\n        (\r\n          await onError(new Error(\"Missing close-own permission\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n\r\n    if (\r\n      !userPermissions.tickets.canClose &&\r\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\r\n    )\r\n      return interaction.reply(\r\n        (\r\n          await onError(new Error(\"Missing close permission\"), {\r\n            ticketId: ticketId,\r\n          })\r\n        ).discordMsg\r\n      );\r\n\r\n    interaction.showModal(\r\n      new ModalBuilder()\r\n        .setTitle(\"Close Ticket\")\r\n        .setCustomId(`close:${ticketId}`)\r\n        .addComponents(\r\n          new ActionRowBuilder<TextInputBuilder>().addComponents(\r\n            new TextInputBuilder()\r\n              .setCustomId(\"duration\")\r\n              .setLabel(\"Duration (10mins)\")\r\n              .setMaxLength(100)\r\n              .setPlaceholder(`Leave blank to close instantly`)\r\n              .setStyle(TextInputStyle.Short)\r\n              .setRequired(false)\r\n          ),\r\n          new ActionRowBuilder<TextInputBuilder>().addComponents(\r\n            new TextInputBuilder()\r\n              .setCustomId(\"reason\")\r\n              .setLabel(\"Reason\")\r\n              .setMaxLength(100)\r\n              .setPlaceholder(`Why are you closing this ticket?`)\r\n              .setStyle(TextInputStyle.Short)\r\n              .setRequired(false)\r\n          )\r\n        )\r\n    );\r\n  },\r\n};\r\n\r\nexport default button;\r\n"],"names":[],"mappings":";;;;AAAA,2CAOoB;AAEpB,mFAA0E;AAC1E,yDAA4E;AAC5E,iDAA8C;AAE9C,MAAM,MAAM,GAAkB;IAC5B,QAAQ,EAAE,OAAO;IACjB,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW;QACrC,IAAI,CAAC,WAAW,CAAC,OAAO;YAAE,OAAO;QACjC,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QACpD,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAS,EAAC,QAAQ,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAI,CAAC,MAAM;YACT,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,kBAAkB,CAAC,EAAE;gBAC3C,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QACJ,MAAM,eAAe,GAAG,IAAA,6CAAkB,EACxC,WAAW,CAAC,MAAqB,EACjC,MAAM,IAAA,gCAAoB,EAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,CAC/D,CAAC;QAEF,IACE,CAAC,eAAe,CAAC,OAAO,CAAC,aAAa;YACtC,WAAW,CAAC,IAAI,CAAC,EAAE,KAAK,MAAM,CAAC,KAAK;YACpC,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,gCAAmB,CAAC,WAAW,CAAC;YAEpE,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,8BAA8B,CAAC,EAAE;gBACvD,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QAEJ,IACE,CAAC,eAAe,CAAC,OAAO,CAAC,QAAQ;YACjC,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,gCAAmB,CAAC,WAAW,CAAC;YAEpE,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,0BAA0B,CAAC,EAAE;gBACnD,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QAEJ,WAAW,CAAC,SAAS,CACnB,IAAI,yBAAY,EAAE;aACf,QAAQ,CAAC,cAAc,CAAC;aACxB,WAAW,CAAC,SAAS,QAAQ,EAAE,CAAC;aAChC,aAAa,CACZ,IAAI,6BAAgB,EAAoB,CAAC,aAAa,CACpD,IAAI,6BAAgB,EAAE;aACnB,WAAW,CAAC,UAAU,CAAC;aACvB,QAAQ,CAAC,mBAAmB,CAAC;aAC7B,YAAY,CAAC,GAAG,CAAC;aACjB,cAAc,CAAC,gCAAgC,CAAC;aAChD,QAAQ,CAAC,2BAAc,CAAC,KAAK,CAAC;aAC9B,WAAW,CAAC,KAAK,CAAC,CACtB,EACD,IAAI,6BAAgB,EAAoB,CAAC,aAAa,CACpD,IAAI,6BAAgB,EAAE;aACnB,WAAW,CAAC,QAAQ,CAAC;aACrB,QAAQ,CAAC,QAAQ,CAAC;aAClB,YAAY,CAAC,GAAG,CAAC;aACjB,cAAc,CAAC,kCAAkC,CAAC;aAClD,QAAQ,CAAC,2BAAc,CAAC,KAAK,CAAC;aAC9B,WAAW,CAAC,KAAK,CAAC,CACtB,CACF,CACJ,CAAC;IACJ,CAAC;CACF,CAAC;AAEF,kBAAe,MAAM,CAAC","debug_id":"c3b6cc47-e2da-5d47-b42a-74b7eeecb886"}