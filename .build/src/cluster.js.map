{"version":3,"file":"cluster.js","sources":["src/cluster.ts"],"sourceRoot":"/","sourcesContent":["import \"@dotenvx/dotenvx\";\nimport { ClusterManager, HeartbeatManager } from \"discord-hybrid-sharding\";\nimport { Client } from \"discord-cross-hosting\";\nimport \"./instrument\";\nimport logger from \"./utils/logger\";\n\nconst client = new Client({\n  agent: \"bot\",\n  host: process.env[\"BRIDGE_HOST\"],\n  port: parseInt(process.env[\"BRIDGE_PORT\"]!),\n  authToken: process.env[\"BRIDGE_AUTH\"]!,\n  rollingRestarts: false,\n});\nclient.connect();\n\nconst manager = new ClusterManager(`${__dirname}/index.js`, {\n  shardsPerClusters: parseInt(process.env[\"SHARDS_PER_CLUSTER\"]!, 10),\n  totalClusters: parseInt(process.env[\"TOTAL_CLUSTERS\"]!, 10),\n  mode: \"process\",\n  token: process.env[\"DISCORD_TOKEN\"],\n});\n\nmanager.extend(\n  new HeartbeatManager({\n    interval: 1000 * 60 * 60 * 5,\n    maxMissedHeartbeats: 5,\n  })\n);\n\nmanager.on(\"clusterCreate\", (cluster) =>\n  logger.info(\n    `Launched Cluster ${cluster.id} with shards: ${cluster.shardList.join(\n      \", \"\n    )}`\n  )\n);\nclient.listen(manager);\nclient\n  .requestShardData()\n  .then((e) => {\n    if (!e) return;\n    if (!e.shardList) return;\n    manager.totalShards = e.totalShards;\n    manager.totalClusters = e.shardList.length;\n    manager.shardList = e.shardList;\n    manager.clusterList = e.clusterList;\n    manager.spawn({ timeout: -1 });\n  })\n  .catch((e) => logger.error(\"Cluster Error\", e));\n"],"names":[],"mappings":";;;;;;;AAAA,4BAA0B;AAC1B,qEAA2E;AAC3E,iEAA+C;AAC/C,wBAAsB;AACtB,4DAAoC;AAEpC,MAAM,MAAM,GAAG,IAAI,8BAAM,CAAC;IACxB,KAAK,EAAE,KAAK;IACZ,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC;IAChC,IAAI,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,CAAE,CAAC;IAC3C,SAAS,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,CAAE;IACtC,eAAe,EAAE,KAAK;CACvB,CAAC,CAAC;AACH,MAAM,CAAC,OAAO,EAAE,CAAC;AAEjB,MAAM,OAAO,GAAG,IAAI,wCAAc,CAAC,GAAG,SAAS,WAAW,EAAE;IAC1D,iBAAiB,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAE,EAAE,EAAE,CAAC;IACnE,aAAa,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAE,EAAE,EAAE,CAAC;IAC3D,IAAI,EAAE,SAAS;IACf,KAAK,EAAE,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC;CACpC,CAAC,CAAC;AAEH,OAAO,CAAC,MAAM,CACZ,IAAI,0CAAgB,CAAC;IACnB,QAAQ,EAAE,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;IAC5B,mBAAmB,EAAE,CAAC;CACvB,CAAC,CACH,CAAC;AAEF,OAAO,CAAC,EAAE,CAAC,eAAe,EAAE,CAAC,OAAO,EAAE,EAAE,CACtC,gBAAM,CAAC,IAAI,CACT,oBAAoB,OAAO,CAAC,EAAE,iBAAiB,OAAO,CAAC,SAAS,CAAC,IAAI,CACnE,IAAI,CACL,EAAE,CACJ,CACF,CAAC;AACF,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AACvB,MAAM;KACH,gBAAgB,EAAE;KAClB,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE;IACV,IAAI,CAAC,CAAC;QAAE,OAAO;IACf,IAAI,CAAC,CAAC,CAAC,SAAS;QAAE,OAAO;IACzB,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,CAAC;IACpC,OAAO,CAAC,aAAa,GAAG,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC;IAC3C,OAAO,CAAC,SAAS,GAAG,CAAC,CAAC,SAAS,CAAC;IAChC,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,CAAC;IACpC,OAAO,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;AACjC,CAAC,CAAC;KACD,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,gBAAM,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,CAAC","debug_id":"26ca9643-7646-552c-95f7-648cccbe2590"}