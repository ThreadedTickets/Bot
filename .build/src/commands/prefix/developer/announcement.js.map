{"version":3,"file":"announcement.js","sources":["src/commands/prefix/developer/announcement.ts"],"sourceRoot":"/","sourcesContent":["import { ActionRowBuilder, ButtonBuilder, ButtonStyle } from \"discord.js\";\nimport { CommandPermission } from \"../../../constants/permissions\";\nimport { PrefixCommand } from \"../../../types/Command\";\nimport { getServerMessage } from \"../../../utils/bot/getServer\";\nimport {\n  countAnnouncementViews,\n  hasUserViewedAnnouncement,\n} from \"../../../utils/bot/viewAnnouncement\";\nimport serverMessageToDiscordMessage from \"../../../utils/formatters/serverMessageToDiscordMessage\";\nimport redis from \"../../../utils/redis\";\n\nconst command: PrefixCommand<{\n  action: \"set\" | \"del\" | \"view\" | \"count\";\n  messageId: string;\n  userId: string;\n}> = {\n  name: \"announcement\",\n  aliases: [\"ann\"],\n  permissionLevel: CommandPermission.Owner,\n  usage:\n    \"<action:(set|del|view|count)> <messageId{action === 'set'}> <userId{action === 'view'}>\",\n  async execute(client, data, msg, args) {\n    if (!msg.guildId) return;\n    const { action, messageId, userId } = args;\n\n    if (action === \"set\") {\n      const message = await getServerMessage(messageId, msg.guildId);\n      if (!message) return msg.reply(\"Invalid message\");\n\n      const parsedMessage = serverMessageToDiscordMessage(message);\n\n      await redis.set(\n        \"announcement\",\n        JSON.stringify({\n          ...parsedMessage,\n          components: [\n            new ActionRowBuilder<ButtonBuilder>().addComponents(\n              new ButtonBuilder()\n                .setURL(process.env[\"DISCORD_SUPPORT_INVITE\"]!)\n                .setStyle(ButtonStyle.Link)\n                .setLabel(\"Support Server\")\n            ),\n          ],\n        })\n      );\n      await redis.del(\"announcement:viewed\");\n\n      msg.reply(\"Done\");\n    } else if (action === \"del\") {\n      await redis.del(\"announcement\");\n      msg.reply(\"Done\");\n    } else if (action === \"count\") {\n      msg.reply(`total views: ${await countAnnouncementViews()}`);\n    } else if (action === \"view\") {\n      msg.reply(`viewed: ${await hasUserViewedAnnouncement(userId)}`);\n    }\n  },\n};\n\nexport default command;\n"],"names":[],"mappings":";;;;;;;AAAA,2CAA0E;AAC1E,gEAAmE;AAEnE,4DAAgE;AAChE,0EAG6C;AAC7C,4HAAoG;AACpG,iEAAyC;AAEzC,MAAM,OAAO,GAIR;IACH,IAAI,EAAE,cAAc;IACpB,OAAO,EAAE,CAAC,KAAK,CAAC;IAChB,eAAe,EAAE,+BAAiB,CAAC,KAAK;IACxC,KAAK,EACH,yFAAyF;IAC3F,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI;QACnC,IAAI,CAAC,GAAG,CAAC,OAAO;YAAE,OAAO;QACzB,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC;QAE3C,IAAI,MAAM,KAAK,KAAK,EAAE,CAAC;YACrB,MAAM,OAAO,GAAG,MAAM,IAAA,4BAAgB,EAAC,SAAS,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC;YAC/D,IAAI,CAAC,OAAO;gBAAE,OAAO,GAAG,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;YAElD,MAAM,aAAa,GAAG,IAAA,uCAA6B,EAAC,OAAO,CAAC,CAAC;YAE7D,MAAM,eAAK,CAAC,GAAG,CACb,cAAc,EACd,IAAI,CAAC,SAAS,CAAC;gBACb,GAAG,aAAa;gBAChB,UAAU,EAAE;oBACV,IAAI,6BAAgB,EAAiB,CAAC,aAAa,CACjD,IAAI,0BAAa,EAAE;yBAChB,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAE,CAAC;yBAC9C,QAAQ,CAAC,wBAAW,CAAC,IAAI,CAAC;yBAC1B,QAAQ,CAAC,gBAAgB,CAAC,CAC9B;iBACF;aACF,CAAC,CACH,CAAC;YACF,MAAM,eAAK,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;YAEvC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACpB,CAAC;aAAM,IAAI,MAAM,KAAK,KAAK,EAAE,CAAC;YAC5B,MAAM,eAAK,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;YAChC,GAAG,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACpB,CAAC;aAAM,IAAI,MAAM,KAAK,OAAO,EAAE,CAAC;YAC9B,GAAG,CAAC,KAAK,CAAC,gBAAgB,MAAM,IAAA,yCAAsB,GAAE,EAAE,CAAC,CAAC;QAC9D,CAAC;aAAM,IAAI,MAAM,KAAK,MAAM,EAAE,CAAC;YAC7B,GAAG,CAAC,KAAK,CAAC,WAAW,MAAM,IAAA,4CAAyB,EAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAClE,CAAC;IACH,CAAC;CACF,CAAC;AAEF,kBAAe,OAAO,CAAC","debug_id":"cd2d24ab-f86e-5767-add1-3ccf88ad1c05"}