{"version":3,"file":"ticket.js","sources":["src/commands/prefix/ticket.ts"],"sourceRoot":"/","sourcesContent":["import { t } from \"../../lang\";\nimport { PrefixCommand } from \"../../types/Command\";\nimport { getServerTicketTrigger } from \"../../utils/bot/getServer\";\nimport { onError } from \"../../utils/onError\";\nimport { TicketTrigger } from \"../../types/Ticket\";\nimport {\n  canCreateTicketTarget,\n  performTicketChecks,\n} from \"../../utils/tickets/performChecks\";\nimport { getGuildMember } from \"../../utils/bot/getGuildMember\";\nimport { runHooks } from \"../../utils/hooks\";\n\nconst cmd: PrefixCommand<{\n  triggerId: string;\n  user?: string;\n}> = {\n  name: \"ticket\",\n  usage: \"<triggerId> [user]\",\n\n  async execute(client, data, message, args) {\n    if (!message.guildId) return;\n    if (!message.author.bot) return;\n    const triggerId = args.triggerId;\n    const user = message.mentions.users.first();\n\n    if (!user)\n      return message.reply(\n        (await onError(new Error(t(data.lang!, \"ERROR_CODE_2013\")))).discordMsg\n      );\n\n    const trigger = await getServerTicketTrigger(triggerId, message.guildId);\n    if (!trigger)\n      return message.reply(\n        (await onError(new Error(\"Trigger not found\"))).discordMsg\n      );\n\n    const member = await getGuildMember(client, message.guildId, user.id);\n    if (!member)\n      return message.reply(\n        (await onError(new Error(t(data.lang!, \"ERROR_CODE_2014\")))).discordMsg\n      );\n\n    const triggerObject = trigger.toObject();\n    const triggerTyped: TicketTrigger = {\n      ...triggerObject,\n    };\n\n    const msg = await message.reply({\n      content: t(data.lang!, \"TICKET_CREATE_PERFORMING_CHECKS\"),\n    });\n\n    const checks = await performTicketChecks(triggerTyped, member);\n\n    if (!checks.allowed) {\n      return msg.edit(\n        (await onError(new Error(t(data.lang!, `ERROR_CODE_${checks.error}`))))\n          .discordMsg\n      );\n    }\n\n    const checkTargetChannel = await canCreateTicketTarget(\n      message.guild!,\n      trigger.isThread ? \"thread\" : \"channel\",\n      trigger.openChannel\n    );\n    if (!checkTargetChannel.allowed)\n      return msg.edit(\n        (\n          await onError(\n            new Error(t(data.lang!, `ERROR_CODE_${checkTargetChannel.error}`))\n          )\n        ).discordMsg\n      );\n\n    await msg.edit({\n      content: t(data.lang!, \"TICKET_CREATE_CHECKS_PASSED\"),\n    });\n\n    runHooks(\"TicketCreate\", {\n      client: client,\n      guild: message.guild!,\n      lang: data.lang!,\n      messageOrInteraction: msg,\n      owner: member.id,\n      responses: [],\n      trigger: triggerTyped,\n      user: user,\n    });\n  },\n};\n\nexport default cmd;\n"],"names":[],"mappings":"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","debug_id":"d30a831c-a2e0-578c-b8e5-1b35f03b941f"}