{"version":3,"file":"close.js","sources":["src/commands/interactions/slash/close.ts"],"sourceRoot":"/","sourcesContent":["import {\n  ActionRowBuilder,\n  GuildMember,\n  InteractionContextType,\n  ModalBuilder,\n  PermissionFlagsBits,\n  SlashCommandBuilder,\n  TextInputBuilder,\n  TextInputStyle,\n} from \"discord.js\";\nimport { AppCommand } from \"../../../types/Command\";\nimport { t } from \"../../../lang\";\nimport { TicketChannelManager } from \"../../../utils/bot/TicketChannelManager\";\nimport { getServerGroupsByIds, getTicket } from \"../../../utils/bot/getServer\";\nimport { onError } from \"../../../utils/onError\";\nimport { getUserPermissions } from \"../../../utils/calculateUserPermissions\";\n\nconst command: AppCommand = {\n  type: \"slash\",\n  data: new SlashCommandBuilder()\n    .setName(\"close\")\n    .setDescription(\"Close the ticket\")\n    .setContexts(InteractionContextType.Guild)\n    .setNameLocalizations({})\n    .setDescriptionLocalizations({}),\n\n  async execute(client, data, interaction) {\n    if (!interaction.guildId) return;\n    const ticketId = await new TicketChannelManager().getTicketId(\n      interaction.channelId\n    );\n    if (!ticketId)\n      return interaction.reply(\n        (\n          await onError(new Error(\"Ticket not found\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n    const ticket = await getTicket(ticketId, interaction.guildId);\n    if (!ticket)\n      return interaction.reply(\n        (\n          await onError(new Error(\"Ticket not found\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n    const userPermissions = getUserPermissions(\n      interaction.member as GuildMember,\n      await getServerGroupsByIds(ticket.groups, interaction.guildId)\n    );\n\n    if (\n      !userPermissions.tickets.canCloseIfOwn &&\n      interaction.user.id === ticket.owner &&\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\n    )\n      return interaction.reply(\n        (\n          await onError(new Error(\"Missing close-own permission\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n\n    if (\n      !userPermissions.tickets.canClose &&\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\n    )\n      return interaction.reply(\n        (\n          await onError(new Error(\"Missing close permission\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n\n    interaction.showModal(\n      new ModalBuilder()\n        .setTitle(\"Close Ticket\")\n        .setCustomId(`close:${ticketId}`)\n        .addComponents(\n          new ActionRowBuilder<TextInputBuilder>().addComponents(\n            new TextInputBuilder()\n              .setCustomId(\"duration\")\n              .setLabel(\"Duration (10mins)\")\n              .setMaxLength(100)\n              .setPlaceholder(`Leave blank to close instantly`)\n              .setStyle(TextInputStyle.Short)\n              .setRequired(false)\n          ),\n          new ActionRowBuilder<TextInputBuilder>().addComponents(\n            new TextInputBuilder()\n              .setCustomId(\"reason\")\n              .setLabel(\"Reason\")\n              .setMaxLength(100)\n              .setPlaceholder(`Why are you closing this ticket?`)\n              .setStyle(TextInputStyle.Short)\n              .setRequired(false)\n          )\n        )\n    );\n  },\n};\n\nexport default command;\n"],"names":[],"mappings":"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","debug_id":"b9531d53-393c-5f81-aaf2-6fa4dce29c0c"}