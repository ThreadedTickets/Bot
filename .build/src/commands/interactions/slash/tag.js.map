{"version":3,"file":"tag.js","sources":["src/commands/interactions/slash/tag.ts"],"sourceRoot":"/","sourcesContent":["import {\n  Channel,\n  GuildMember,\n  InteractionContextType,\n  MessageFlags,\n  SlashCommandBuilder,\n} from \"discord.js\";\nimport { AppCommand } from \"../../../types/Command\";\nimport {\n  getServerMessage,\n  getServerTag,\n  getServerTags,\n} from \"../../../utils/bot/getServer\";\nimport { onError } from \"../../../utils/onError\";\nimport { t } from \"../../../lang\";\nimport { resolveDiscordMessagePlaceholders } from \"../../../utils/message/placeholders/resolvePlaceholders\";\nimport serverMessageToDiscordMessage from \"../../../utils/formatters/serverMessageToDiscordMessage\";\nimport { generateBasePlaceholderContext } from \"../../../utils/message/placeholders/generateBaseContext\";\n\nconst command: AppCommand = {\n  type: \"slash\",\n  data: new SlashCommandBuilder()\n    .setName(\"tag\")\n    .setDescription(\"Send a tag\")\n    .setContexts(InteractionContextType.Guild)\n    .setNameLocalizations({})\n    .setDescriptionLocalizations({})\n    .addStringOption((opt) =>\n      opt\n        .setName(\"tag\")\n        .setDescription(\"Which tag do you want to send?\")\n        .setRequired(true)\n        .setNameLocalizations({})\n        .setDescriptionLocalizations({})\n        .setAutocomplete(true)\n    )\n    .addStringOption((opt) =>\n      opt\n        .setName(\"preview\")\n        .setDescription(\"Do you want to preview this tag rather than send it?\")\n        .setChoices([\n          { name: \"Yes\", value: \"true\" },\n          { name: \"No\", value: \"false\" },\n        ])\n    ),\n\n  async autocomplete(client, interaction) {\n    if (!interaction.guildId) return;\n    const focused = interaction.options.getFocused(true).name;\n\n    if (focused === \"tag\") {\n      const focusedValue = interaction.options.getString(\"tag\", true);\n      const tags = await getServerTags(interaction.guildId);\n      if (!tags.length) {\n        interaction.respond([\n          {\n            name: \"You don't have any tags!\",\n            value: \"\",\n          },\n        ]);\n        return;\n      }\n\n      const filtered = tags.filter((m) =>\n        m.name.toLowerCase().includes(focusedValue.toLowerCase())\n      );\n\n      interaction.respond(\n        filtered\n          .map((m) => ({\n            name: m.name,\n            value: m._id,\n          }))\n          .slice(0, 25)\n      );\n    }\n  },\n\n  async execute(client, data, interaction) {\n    if (!interaction.guildId) return;\n    const showPreview = interaction.options.getString(\"preview\") === \"true\";\n    const tagId = interaction.options.getString(\"tag\", true);\n    const lang = data.lang!;\n\n    const tag = await getServerTag(tagId, interaction.guildId);\n    if (!tag)\n      return interaction.reply(\n        (await onError(new Error(\"Tag not found\"))).discordMsg\n      );\n\n    const message = await getServerMessage(tag.message, interaction.guildId);\n    if (!message)\n      return interaction.reply(\n        (await onError(new Error(\"Tag message not found\"))).discordMsg\n      );\n\n    interaction.reply({\n      flags: showPreview ? [MessageFlags.Ephemeral] : [],\n      ...resolveDiscordMessagePlaceholders(\n        serverMessageToDiscordMessage(message),\n        generateBasePlaceholderContext({\n          server: interaction.guild!,\n          user: interaction.user,\n          member: interaction.member as GuildMember,\n          channel: interaction.channel as Channel,\n        })\n      ),\n    });\n  },\n};\n\nexport default command;\n"],"names":[],"mappings":"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","debug_id":"690a61c0-9878-514d-988e-8aab3fa21b53"}