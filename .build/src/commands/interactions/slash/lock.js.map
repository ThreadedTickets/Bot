{"version":3,"file":"lock.js","sources":["src/commands/interactions/slash/lock.ts"],"sourceRoot":"/","sourcesContent":["import {\n  GuildMember,\n  InteractionContextType,\n  MessageFlags,\n  PermissionFlagsBits,\n  SlashCommandBuilder,\n} from \"discord.js\";\nimport { AppCommand } from \"../../../types/Command\";\nimport { t } from \"../../../lang\";\nimport { TicketChannelManager } from \"../../../utils/bot/TicketChannelManager\";\nimport { getServerGroupsByIds, getTicket } from \"../../../utils/bot/getServer\";\nimport { onError } from \"../../../utils/onError\";\nimport { getUserPermissions } from \"../../../utils/calculateUserPermissions\";\nimport { lockTicket } from \"../../../utils/tickets/lock\";\n\nconst command: AppCommand = {\n  type: \"slash\",\n  data: new SlashCommandBuilder()\n    .setName(\"lock\")\n    .setDescription(\"Lock the ticket\")\n    .setContexts(InteractionContextType.Guild)\n    .setNameLocalizations({})\n    .setDescriptionLocalizations({}),\n\n  async execute(client, data, interaction) {\n    if (!interaction.guildId) return;\n    const ticketId = await new TicketChannelManager().getTicketId(\n      interaction.channelId\n    );\n    if (!ticketId)\n      return interaction.reply(\n        (\n          await onError(new Error(\"Ticket not found\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n    const ticket = await getTicket(ticketId, interaction.guildId);\n    if (!ticket)\n      return interaction.reply(\n        (\n          await onError(new Error(\"Ticket not found\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n    const userPermissions = getUserPermissions(\n      interaction.member as GuildMember,\n      await getServerGroupsByIds(ticket.groups, interaction.guildId)\n    );\n\n    if (\n      !userPermissions.tickets.canLock &&\n      !interaction.memberPermissions?.has(PermissionFlagsBits.ManageGuild)\n    )\n      return interaction.reply(\n        (\n          await onError(new Error(\"Missing lock permission\"), {\n            ticketId: ticketId,\n          })\n        ).discordMsg\n      );\n\n    await interaction.reply({\n      content: t(data.lang!, \"THINK\"),\n      flags: [MessageFlags.Ephemeral],\n    });\n\n    await lockTicket(ticketId, data.lang!, interaction);\n  },\n};\n\nexport default command;\n"],"names":[],"mappings":";;;;AAAA,2CAMoB;AAEpB,wCAAkC;AAClC,kFAA+E;AAC/E,4DAA+E;AAC/E,oDAAiD;AACjD,sFAA6E;AAC7E,sDAAyD;AAEzD,MAAM,OAAO,GAAe;IAC1B,IAAI,EAAE,OAAO;IACb,IAAI,EAAE,IAAI,gCAAmB,EAAE;SAC5B,OAAO,CAAC,MAAM,CAAC;SACf,cAAc,CAAC,iBAAiB,CAAC;SACjC,WAAW,CAAC,mCAAsB,CAAC,KAAK,CAAC;SACzC,oBAAoB,CAAC,EAAE,CAAC;SACxB,2BAA2B,CAAC,EAAE,CAAC;IAElC,KAAK,CAAC,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,WAAW;QACrC,IAAI,CAAC,WAAW,CAAC,OAAO;YAAE,OAAO;QACjC,MAAM,QAAQ,GAAG,MAAM,IAAI,2CAAoB,EAAE,CAAC,WAAW,CAC3D,WAAW,CAAC,SAAS,CACtB,CAAC;QACF,IAAI,CAAC,QAAQ;YACX,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,kBAAkB,CAAC,EAAE;gBAC3C,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QACJ,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAS,EAAC,QAAQ,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;QAC9D,IAAI,CAAC,MAAM;YACT,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,kBAAkB,CAAC,EAAE;gBAC3C,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QACJ,MAAM,eAAe,GAAG,IAAA,6CAAkB,EACxC,WAAW,CAAC,MAAqB,EACjC,MAAM,IAAA,gCAAoB,EAAC,MAAM,CAAC,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,CAC/D,CAAC;QAEF,IACE,CAAC,eAAe,CAAC,OAAO,CAAC,OAAO;YAChC,CAAC,WAAW,CAAC,iBAAiB,EAAE,GAAG,CAAC,gCAAmB,CAAC,WAAW,CAAC;YAEpE,OAAO,WAAW,CAAC,KAAK,CACtB,CACE,MAAM,IAAA,iBAAO,EAAC,IAAI,KAAK,CAAC,yBAAyB,CAAC,EAAE;gBAClD,QAAQ,EAAE,QAAQ;aACnB,CAAC,CACH,CAAC,UAAU,CACb,CAAC;QAEJ,MAAM,WAAW,CAAC,KAAK,CAAC;YACtB,OAAO,EAAE,IAAA,QAAC,EAAC,IAAI,CAAC,IAAK,EAAE,OAAO,CAAC;YAC/B,KAAK,EAAE,CAAC,yBAAY,CAAC,SAAS,CAAC;SAChC,CAAC,CAAC;QAEH,MAAM,IAAA,iBAAU,EAAC,QAAQ,EAAE,IAAI,CAAC,IAAK,EAAE,WAAW,CAAC,CAAC;IACtD,CAAC;CACF,CAAC;AAEF,kBAAe,OAAO,CAAC","debug_id":"b02263ae-709f-522f-b374-c09374aacfd8"}