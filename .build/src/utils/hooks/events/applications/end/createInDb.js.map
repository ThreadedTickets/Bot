{"version":3,"file":"createInDb.js","sources":["src/utils/hooks/events/applications/end/createInDb.ts"],"sourceRoot":"/","sourcesContent":["import { Client } from \"discord.js\";\nimport { registerHook, runHooks } from \"../../..\";\nimport { CompletedApplicationSchema } from \"../../../../../database/modals/CompletedApplications\";\nimport {\n  Application,\n  ApplicationQuestion,\n} from \"../../../../../types/Application\";\nimport { generateId } from \"../../../../database/generateId\";\nimport { invalidateCache } from \"../../../../database/invalidateCache\";\n\nregisterHook(\n  \"ApplicationEnd\",\n  async ({\n    application,\n    responses,\n    owner,\n    client,\n  }: {\n    application: Application;\n    responses: {\n      applicationId: string;\n      startTime: Date;\n      server: string;\n      questionNumber: number;\n      questions: ApplicationQuestion[];\n\n      responses: { question: string; response: string }[];\n    };\n    owner: string;\n    client: Client;\n  }) => {\n    const id = generateId(\"CA\");\n    await CompletedApplicationSchema.create({\n      _id: id,\n      application: application._id,\n      createdAt: new Date(),\n      owner: owner,\n      responses: responses.responses,\n    });\n\n    invalidateCache(`runningApplications:${owner}`);\n    invalidateCache(`completedApps:${application._id}:${owner}:all`);\n    invalidateCache(`completedApps:${application._id}:Pending`);\n\n    runHooks(\"ApplicationFinal\", { application, responses, owner, client, id });\n  },\n  10\n);\n"],"names":[],"mappings":";;;;AACA,gCAAkD;AAClD,gGAAkG;AAKlG,gEAA6D;AAC7D,0EAAuE;AAEvE,IAAA,gBAAY,EACV,gBAAgB,EAChB,KAAK,EAAE,EACL,WAAW,EACX,SAAS,EACT,KAAK,EACL,MAAM,GAcP,EAAE,EAAE;IACH,MAAM,EAAE,GAAG,IAAA,uBAAU,EAAC,IAAI,CAAC,CAAC;IAC5B,MAAM,kDAA0B,CAAC,MAAM,CAAC;QACtC,GAAG,EAAE,EAAE;QACP,WAAW,EAAE,WAAW,CAAC,GAAG;QAC5B,SAAS,EAAE,IAAI,IAAI,EAAE;QACrB,KAAK,EAAE,KAAK;QACZ,SAAS,EAAE,SAAS,CAAC,SAAS;KAC/B,CAAC,CAAC;IAEH,IAAA,iCAAe,EAAC,uBAAuB,KAAK,EAAE,CAAC,CAAC;IAChD,IAAA,iCAAe,EAAC,iBAAiB,WAAW,CAAC,GAAG,IAAI,KAAK,MAAM,CAAC,CAAC;IACjE,IAAA,iCAAe,EAAC,iBAAiB,WAAW,CAAC,GAAG,UAAU,CAAC,CAAC;IAE5D,IAAA,YAAQ,EAAC,kBAAkB,EAAE,EAAE,WAAW,EAAE,SAAS,EAAE,KAAK,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC;AAC9E,CAAC,EACD,EAAE,CACH,CAAC","debug_id":"c12ac08d-ff2a-5eb6-a2ce-64483a2d424a"}