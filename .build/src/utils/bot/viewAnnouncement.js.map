{"version":3,"file":"viewAnnouncement.js","sources":["src/utils/bot/viewAnnouncement.ts"],"sourceRoot":"/","sourcesContent":["import redis from \"../redis\";\n\nexport async function viewAnnouncement(userId: string) {\n  const announcementKey = \"announcement\";\n  const viewedSetKey = \"announcement:viewed\";\n\n  // Check if announcement exists\n  const announcement = await redis.get(announcementKey);\n  if (!announcement) return false;\n\n  // Check if user has already viewed the announcement\n  const hasViewed = await redis.sismember(viewedSetKey, userId);\n  if (hasViewed) return false;\n\n  // Mark as viewed\n  await redis.sadd(viewedSetKey, userId);\n\n  return JSON.parse(announcement); // assuming it's stored as JSON\n}\n\nexport async function getAnnouncement() {\n  const announcementKey = \"announcement\";\n  const announcement = await redis.get(announcementKey);\n  if (!announcement) return null;\n  return announcement;\n}\n\nexport async function countAnnouncementViews(): Promise<number> {\n  return await redis.scard(\"announcement:viewed\");\n}\n\nexport async function hasUserViewedAnnouncement(\n  userId: string\n): Promise<boolean> {\n  return await redis\n    .sismember(\"announcement:viewed\", userId)\n    .then((res) => res === 1);\n}\n"],"names":[],"mappings":";;;;;;;AAEA,4CAgBC;AAED,0CAKC;AAED,wDAEC;AAED,8DAMC;AArCD,qDAA6B;AAEtB,KAAK,UAAU,gBAAgB,CAAC,MAAc;IACnD,MAAM,eAAe,GAAG,cAAc,CAAC;IACvC,MAAM,YAAY,GAAG,qBAAqB,CAAC;IAE3C,+BAA+B;IAC/B,MAAM,YAAY,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;IACtD,IAAI,CAAC,YAAY;QAAE,OAAO,KAAK,CAAC;IAEhC,oDAAoD;IACpD,MAAM,SAAS,GAAG,MAAM,eAAK,CAAC,SAAS,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;IAC9D,IAAI,SAAS;QAAE,OAAO,KAAK,CAAC;IAE5B,iBAAiB;IACjB,MAAM,eAAK,CAAC,IAAI,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;IAEvC,OAAO,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,+BAA+B;AAClE,CAAC;AAEM,KAAK,UAAU,eAAe;IACnC,MAAM,eAAe,GAAG,cAAc,CAAC;IACvC,MAAM,YAAY,GAAG,MAAM,eAAK,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;IACtD,IAAI,CAAC,YAAY;QAAE,OAAO,IAAI,CAAC;IAC/B,OAAO,YAAY,CAAC;AACtB,CAAC;AAEM,KAAK,UAAU,sBAAsB;IAC1C,OAAO,MAAM,eAAK,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC;AAClD,CAAC;AAEM,KAAK,UAAU,yBAAyB,CAC7C,MAAc;IAEd,OAAO,MAAM,eAAK;SACf,SAAS,CAAC,qBAAqB,EAAE,MAAM,CAAC;SACxC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC;AAC9B,CAAC","debug_id":"dd6b2430-330e-5cda-b6af-a291e7e430b6"}