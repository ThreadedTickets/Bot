{"version":3,"file":"await-reply.js","sources":["src/utils/tickets/await-reply.ts"],"sourceRoot":"/","sourcesContent":["import { TextChannel } from \"discord.js\";\nimport { client } from \"../..\";\nimport { fetchChannelById } from \"../bot/fetchMessage\";\nimport { getTicket } from \"../bot/getServer\";\nimport logger from \"../logger\";\nimport { lockTicket } from \"./lock\";\nimport { closeTicket } from \"./close\";\n\nexport async function awaitReply(\n  serverId: string,\n  ticketId: string,\n  action: \"nothing\" | \"lock\" | \"close\",\n  notify: string | null\n) {\n  logger.debug(`Running await-reply on ${ticketId}`);\n  const ticket = await getTicket(ticketId, serverId);\n  if (!ticket) return;\n\n  const channel = await fetchChannelById(client, ticket.channel);\n  if (!channel) return;\n\n  if (ticket.status !== \"Open\")\n    return (channel as TextChannel)\n      .send(\n        \"The await-reply action cannot run on this ticket as it is not open\"\n      )\n      .catch(() => {});\n\n  const message = await (channel as TextChannel)\n    .send(\"Running automation...\")\n    .catch(() => {});\n  if (!message) return;\n\n  if (action === \"lock\") await lockTicket(ticketId, \"en\", message);\n  if (action === \"close\")\n    return await closeTicket(ticketId, \"en\", \"User did not respond\", message);\n\n  if (notify)\n    await (channel as TextChannel).send(\n      `<@${notify}>, the user has not responded`\n    );\n}\n"],"names":[],"mappings":";;;;;;;AAQA,gCAiCC;AAxCD,6BAA+B;AAC/B,sDAAuD;AACvD,gDAA6C;AAC7C,uDAA+B;AAC/B,iCAAoC;AACpC,mCAAsC;AAE/B,KAAK,UAAU,UAAU,CAC9B,QAAgB,EAChB,QAAgB,EAChB,MAAoC,EACpC,MAAqB;IAErB,gBAAM,CAAC,KAAK,CAAC,0BAA0B,QAAQ,EAAE,CAAC,CAAC;IACnD,MAAM,MAAM,GAAG,MAAM,IAAA,qBAAS,EAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IACnD,IAAI,CAAC,MAAM;QAAE,OAAO;IAEpB,MAAM,OAAO,GAAG,MAAM,IAAA,+BAAgB,EAAC,UAAM,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;IAC/D,IAAI,CAAC,OAAO;QAAE,OAAO;IAErB,IAAI,MAAM,CAAC,MAAM,KAAK,MAAM;QAC1B,OAAQ,OAAuB;aAC5B,IAAI,CACH,oEAAoE,CACrE;aACA,KAAK,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;IAErB,MAAM,OAAO,GAAG,MAAO,OAAuB;SAC3C,IAAI,CAAC,uBAAuB,CAAC;SAC7B,KAAK,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;IACnB,IAAI,CAAC,OAAO;QAAE,OAAO;IAErB,IAAI,MAAM,KAAK,MAAM;QAAE,MAAM,IAAA,iBAAU,EAAC,QAAQ,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;IACjE,IAAI,MAAM,KAAK,OAAO;QACpB,OAAO,MAAM,IAAA,mBAAW,EAAC,QAAQ,EAAE,IAAI,EAAE,sBAAsB,EAAE,OAAO,CAAC,CAAC;IAE5E,IAAI,MAAM;QACR,MAAO,OAAuB,CAAC,IAAI,CACjC,KAAK,MAAM,+BAA+B,CAC3C,CAAC;AACN,CAAC","debug_id":"c555216d-83ba-56f8-ad48-5490f40a5d33"}