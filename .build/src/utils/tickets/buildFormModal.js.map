{"version":3,"file":"buildFormModal.js","sources":["src/utils/tickets/buildFormModal.ts"],"sourceRoot":"/","sourcesContent":["import {\n  ActionRowBuilder,\n  ModalBuilder,\n  TextInputBuilder,\n  TextInputStyle,\n} from \"discord.js\";\nimport { TicketForm } from \"../../types/Ticket\";\n\nconst MAX_FIELDS = 5;\nconst MAX_CHARS = 4000;\nconst MAX_LABEL = 45;\nconst MAX_PLACEHOLDER = 100;\nconst MAX_TITLE = 45;\n\nexport function buildTicketFormModal(\n  questions: TicketForm[],\n  customId: string,\n  title: string\n): ModalBuilder | Error {\n  if (!Array.isArray(questions) || questions.length === 0) {\n    return new Error(\"No form fields provided.\");\n  }\n\n  if (questions.length > MAX_FIELDS) {\n    return new Error(\"Discord modals support up to 5 fields only.\");\n  }\n\n  const modal = new ModalBuilder()\n    .setCustomId(customId)\n    .setTitle(title.slice(0, MAX_TITLE));\n\n  for (let i = 0; i < questions.length; i++) {\n    const form = questions[i];\n    let {\n      question,\n      multilineResponse,\n      requiredResponse,\n      minimumCharactersRequired,\n      maximumCharactersRequired,\n      placeholder,\n      defaultValue,\n    } = form;\n\n    // Trim label and placeholder\n    question = question?.slice(0, MAX_LABEL) || `Question ${i + 1}`;\n    placeholder = placeholder?.slice(0, MAX_PLACEHOLDER) || \"\";\n\n    // Fix min/max range\n    let min = Math.max(0, Math.min(minimumCharactersRequired, MAX_CHARS));\n    let max = Math.max(1, Math.min(maximumCharactersRequired, MAX_CHARS));\n    if (min > max) [min, max] = [max, min]; // swap if incorrect\n\n    // Fix default value\n    let value =\n      typeof defaultValue === \"string\" ? defaultValue.slice(0, max) : null;\n\n    if (value && value.length < min) {\n      value = value.padEnd(min, \" \");\n    }\n\n    // Final validation\n    if (value && (value.length < min || value.length > max)) {\n      return new Error(`Cannot correct default value for \"${question}\".`);\n    }\n\n    const input = new TextInputBuilder()\n      .setCustomId(`form_${i}`)\n      .setLabel(question)\n      .setStyle(\n        multilineResponse ? TextInputStyle.Paragraph : TextInputStyle.Short\n      )\n      .setRequired(requiredResponse)\n      .setMinLength(min)\n      .setMaxLength(max);\n\n    if (placeholder) input.setPlaceholder(placeholder);\n    if (value) input.setValue(value);\n\n    modal.addComponents(\n      new ActionRowBuilder<TextInputBuilder>().addComponents(input)\n    );\n  }\n\n  return modal;\n}\n"],"names":[],"mappings":";;;;AAcA,oDAsEC;AApFD,2CAKoB;AAGpB,MAAM,UAAU,GAAG,CAAC,CAAC;AACrB,MAAM,SAAS,GAAG,IAAI,CAAC;AACvB,MAAM,SAAS,GAAG,EAAE,CAAC;AACrB,MAAM,eAAe,GAAG,GAAG,CAAC;AAC5B,MAAM,SAAS,GAAG,EAAE,CAAC;AAErB,SAAgB,oBAAoB,CAClC,SAAuB,EACvB,QAAgB,EAChB,KAAa;IAEb,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QACxD,OAAO,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;IAC/C,CAAC;IAED,IAAI,SAAS,CAAC,MAAM,GAAG,UAAU,EAAE,CAAC;QAClC,OAAO,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;IAClE,CAAC;IAED,MAAM,KAAK,GAAG,IAAI,yBAAY,EAAE;SAC7B,WAAW,CAAC,QAAQ,CAAC;SACrB,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,CAAC,CAAC;IAEvC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QAC1C,MAAM,IAAI,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QAC1B,IAAI,EACF,QAAQ,EACR,iBAAiB,EACjB,gBAAgB,EAChB,yBAAyB,EACzB,yBAAyB,EACzB,WAAW,EACX,YAAY,GACb,GAAG,IAAI,CAAC;QAET,6BAA6B;QAC7B,QAAQ,GAAG,QAAQ,EAAE,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,IAAI,YAAY,CAAC,GAAG,CAAC,EAAE,CAAC;QAChE,WAAW,GAAG,WAAW,EAAE,KAAK,CAAC,CAAC,EAAE,eAAe,CAAC,IAAI,EAAE,CAAC;QAE3D,oBAAoB;QACpB,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,yBAAyB,EAAE,SAAS,CAAC,CAAC,CAAC;QACtE,IAAI,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,yBAAyB,EAAE,SAAS,CAAC,CAAC,CAAC;QACtE,IAAI,GAAG,GAAG,GAAG;YAAE,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC,oBAAoB;QAE5D,oBAAoB;QACpB,IAAI,KAAK,GACP,OAAO,YAAY,KAAK,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QAEvE,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,GAAG,EAAE,CAAC;YAChC,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACjC,CAAC;QAED,mBAAmB;QACnB,IAAI,KAAK,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,IAAI,KAAK,CAAC,MAAM,GAAG,GAAG,CAAC,EAAE,CAAC;YACxD,OAAO,IAAI,KAAK,CAAC,qCAAqC,QAAQ,IAAI,CAAC,CAAC;QACtE,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,6BAAgB,EAAE;aACjC,WAAW,CAAC,QAAQ,CAAC,EAAE,CAAC;aACxB,QAAQ,CAAC,QAAQ,CAAC;aAClB,QAAQ,CACP,iBAAiB,CAAC,CAAC,CAAC,2BAAc,CAAC,SAAS,CAAC,CAAC,CAAC,2BAAc,CAAC,KAAK,CACpE;aACA,WAAW,CAAC,gBAAgB,CAAC;aAC7B,YAAY,CAAC,GAAG,CAAC;aACjB,YAAY,CAAC,GAAG,CAAC,CAAC;QAErB,IAAI,WAAW;YAAE,KAAK,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;QACnD,IAAI,KAAK;YAAE,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAEjC,KAAK,CAAC,aAAa,CACjB,IAAI,6BAAgB,EAAoB,CAAC,aAAa,CAAC,KAAK,CAAC,CAC9D,CAAC;IACJ,CAAC;IAED,OAAO,KAAK,CAAC;AACf,CAAC","debug_id":"b19ee1d6-0a26-588a-849a-a80502c1332d"}